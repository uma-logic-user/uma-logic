import streamlit as st
import pandas as pd

# --- è¨ºæ–­ç”¨ã‚³ãƒ¼ãƒ‰ (ã“ã“ã‹ã‚‰) ---
st.subheader("ğŸ” ãƒ‡ãƒ¼ã‚¿æ›´æ–°çŠ¶æ³ã®è¨ºæ–­")

# ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ï¼ˆã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦é–¢æ•°åã‚„ãƒ‘ã‚¹ã‚’å¤‰ãˆã¦ãã ã•ã„ï¼‰
# ä¾‹: df = load_data() 
# ã“ã“ã§ã¯ä»®ã« df ã¨ã„ã†å¤‰æ•°ã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã¨ã—ã¾ã™

if 'df' in locals() or 'df' in globals():
    # 1. æ—¥ä»˜ã‚«ãƒ©ãƒ ã®å‹ç¢ºèª
    st.write("ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®åŸºæœ¬æƒ…å ±:")
    st.write(f"è¡Œæ•°: {len(df)}")
    
    # æ—¥ä»˜ã‚«ãƒ©ãƒ ã®åå‰ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹: 'date', 'kaisai_date', 'æ—¥ä»˜' ãªã©ï¼‰
    date_col = 'date'  # â† ã“ã“ã‚’å®Ÿéš›ã®ã‚«ãƒ©ãƒ åã«å¤‰æ›´ã—ã¦ãã ã•ã„
    
    if date_col in df.columns:
        # æ—¥ä»˜å‹ã«å¤‰æ›ï¼ˆå¿µã®ãŸã‚ï¼‰
        try:
            df[date_col] = pd.to_datetime(df[date_col])
            max_date = df[date_col].max()
            st.metric(label="ãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã‚‹æœ€æ–°ã®æ—¥ä»˜", value=str(max_date.date()))
            
            st.write("â–¼ æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã®æœ«å°¾5è¡Œ")
            st.dataframe(df.sort_values(date_col).tail(5))
            
            if max_date < pd.to_datetime("2024-02-01"):
                st.error("âš ï¸ 2æœˆä»¥é™ã®ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ƒãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„ã‹ã€èª­ã¿è¾¼ã¿ã§å¼¾ã‹ã‚Œã¦ã„ã¾ã™ã€‚")
            else:
                st.success("âœ… ãƒ‡ãƒ¼ã‚¿è‡ªä½“ã¯èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚„ãƒ•ã‚£ãƒ«ã‚¿ã®å•é¡Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚")
                
        except Exception as e:
            st.error(f"æ—¥ä»˜å¤‰æ›ã‚¨ãƒ©ãƒ¼: {e}")
    else:
        st.error(f"ã‚«ãƒ©ãƒ å '{date_col}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
else:
    st.warning("å¤‰æ•° 'df' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
# --- è¨ºæ–­ç”¨ã‚³ãƒ¼ãƒ‰ (ã“ã“ã¾ã§) ---
